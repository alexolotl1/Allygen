<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDGMZJ6W9le39t2JRBX-5jm0IRykjStBMc&libraries=places&callback=initMap">
  </script>
  </head>
  <body>
    <div id="header">
        <div id="logo"> Allygen </div>
        <div id="search-bar">
            <input type="text" id="search-input" placeholder="Search...">
            <button onclick="searchRestaurants()">Search</button>
        </div>
    </div>
    <div id="container">
      <div id="sidebar"> 
        <div class="filter-group">
            <h3 class="filter-title">Categories:</h3>
                <div class="filter-options">
                <label><input type="checkbox" name="category" value="non-gmo"> NON-GMO</label>
                <label><input type="checkbox" name="category" value="vegan"> Vegan</label>
                <label><input type="checkbox" name="category" value="vegetarian"> Vegetarian</label>
            </div>
        </div>
        <div class="filter-group">
            <h3 class="filter-title">Allergies:</h3>
                <div class="filter-options">
                    <label><input type="checkbox" name="allergy" value="peanuts"> Peanuts</label>
                    <label><input type="checkbox" name="allergy" value="nuts"> Nuts</label>
                    <label><input type="checkbox" name="allergy" value="dairy"> Dairy/Gluten</label>
                    <label><input type="checkbox" name="allergy" value="eggs"> Eggs</label>
                    <label><input type="checkbox" name="allergy" value="milk"> Milk</label>
                </div>
        </div>
    </div>
      <div id="map">map</div>
    </div>
    <script>
      let map;
      let service;
      let markers=[];

      function initMap() {
        const nyc = new google.maps.LatLng(40.7128, -74.0060);
        map = new google.maps.Map(document.getElementById("map"), {
          center: nyc,
          zoom: 13,
        });
        
        service = new google.maps.places.PlacesService(map);
        searchRestaurants(); // load initial restaurants
      }
      function clearMarkers() {
          markers.forEach(marker => marker.setMap(null));
          markers = [];
      }
      function searchRestaurants() {
        clearMarkers();

        const query = document.getElementById("search-input").value || "restaurant";

        const request = {
          location: map.getCenter(),
          radius: 1000,
          keyword: query,
          type: ["restaurant"]
        };
        service.nearbySearch(request, (results, status) => {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            results.forEach(place => {
              const marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location,
                title: place.name
              });
              const infowindow = new google.maps.InfoWindow({
                content: `<b>${place.name}</b><br>${place.vicinity}`
              });
              marker.addListener("click", () => {
                infowindow.open(map, marker);
              });
              markers.push(marker);
            });
          }
        });
      }
    </script>
  </body>
</html>
